<!--
author: jimmy
head:
date: 2018-09-26
title: Linux命令行与shell脚本
tags: Linux
images: blog/img/2.jpg
category: Linux
status: publish
summary: Linux
-->
## Linux命令行与shell脚本

<!-- @import "[TOC]" {cmd="toc" depthFrom=1 depthTo=6 orderedList=0} -->
<!-- code_chunk_output -->

* [Linux命令行与shell脚本](#linux命令行与shell脚本)
	* [1. Linux基础](#1-linux基础)
		* [1.1 文件系统](#11-文件系统)
		* [1.2 shell](#12-shell)
		* [1.3 Linux安全](#13-linux安全)
			* [1.3.1 /etc/passwd 文件](#131-etcpasswd-文件)
			* [1.3.2 /etc/shadow](#132-etcshadow)
			* [1.3.3 用户管理](#133-用户管理)
			* [1.3.4 组管理](#134-组管理)
			* [1.3.5 文件权限](#135-文件权限)
			* [1.3.6 改变安全性设置](#136-改变安全性设置)
	* [2.shell](#2shell)
		* [2.1 shell基础](#21-shell基础)

<!-- /code_chunk_output -->

本文参考《Linux命令行与shell脚本编程大全》。
### 1. Linux基础
#### 1.1 文件系统
Linux内核支持通过不同类型的文件系统从硬盘中读写数据。除了自有的诸多文件系统外,Linux还支持从其他作系统(比如Microsoft Windows)采用的文件系统中读写数据。
Linux用来读写数据的标准文件系统如下表所示：

| 文件系统 | 描述 |
| :------------- | :------------- |
| ext | Linux扩展文件系统,最早的Linux文件系统 |
| ext2 | 第二扩展文件系统,在ext的基础上提供了更多的功能 |
| ext3 | 第三扩展文件系统,支持日志功能 |
| ext4 | 第四扩展文件系统,支持高级日志功能 |
| hpfs | OS/2高性能文件系统 |
| jfs | IBM日志文件系统 |
| iso9660 | ISO 9660文件系统(CD-ROM) |
| minix | MINIX文件系统 |
| msdos | 微软的FAT16 |
| ncp | Netware文件系统 |
| nfs | 网络文件系统 |
| ntfs | 支持Microsoft NT文件系统 |
| proc | 访问系统信息 |
| ReiserFS | 高级Linux文件系统,能提供更好的性能和硬盘恢复功能 |
| smb | 支持网络访问的Samba SMB文件系统 |
| sysv | 较早期的Unix文件系统 |
| ufs | BSD文件系统 |
| umsdos | 建立在msdos上的类Unix文件系统 |
| vfat | Windows 95文件系统(FAT32) |
| XFS | 高性能64位日志文件系统 |

在Linux文件系统中，通用的目录名用于表示一些常用的功能，下面是一些常见的Linux顶层虚拟目录名及内容：

| 目录 | 用途 |
| :------------- | :------------- |
| / | 虚拟目录的根目录。通常不会在这里存储文件 |
| /bin | 二进制目录,存放许多用户级的GNU工具 |
| /boot | 启动目录,存放启动文件 |
| /dev | 设备目录,Linux在这里创建设备节点 |
| /etc | 系统配置文件目录 |
| /home | 主目录,Linux在这里创建用户目录 |
| /lib | 库目录,存放系统和应用程序的库文件 |
| /media | 媒体目录,可移动媒体设备的常用挂载点 |
| /mnt | 挂载目录,另一个可移动媒体设备的常用挂载点 |
| /opt | 可选目录,常用于存放第三方软件包和数据文件 |
| /proc | 进程目录,存放现有硬件及当前进程的相关信息 |
| /root | root用户的主目录 |
| /sbin | 系统二进制目录,存放许多GNU管理员级工具 |
| /run | 运行目录,存放系统运作时的运行时数据 |
| /srv | 服务目录,存放本地服务的相关文件 |
| /sys | 系统目录,存放系统硬件信息的相关文件 |
| /tmp | 临时目录,可以在该目录中创建和删除临时工作文件 |
| /usr | 用户二进制目录,大量用户级的GNU工具和数据文件都存储在这里 |
| /var | 可变目录,用以存放经常变化的文件,比如日志文件 |

#### 1.2 shell
在Linux系统上,通常有好几种Linux shell可用。不同的shell有不同的特性,有些更利于创建脚本,有些则更利于管理进程。所有Linux发行版默认的shell都是bash shell。

| shell | 描述 |
| :------------- | :------------- |
| ash | 一种运行在内存受限环境中简单的轻量级shell,但与bash shell完全兼容 |
| korn | 一种与Bourne shell兼容的编程shell,但支持如关联数组和浮点运算等一些高级的编程特性 |
| tcsh | 一种将C语言中的一些元素引入到shell脚本中的shell |
| zsh | 一种结合了bash、tcsh和korn的特性,同时提供高级编程特性、共享历史文件和主题化提示符的高级shell |

#### 1.3 Linux安全
Linux安全系统的核心是用户账户。每个能进入Linux系统的用户都会被分配唯一的用户账户。用户对系统中各种对象的访问权限取决于他们登录系统时用的账户。
##### 1.3.1 /etc/passwd 文件
Linux系统使用/etc/passwd 来将用户的登录名匹配到对应的UID值。
> /etc/passwd 包含如下记录：
登录用户名
用户密码 （都为x，正式密码存储在另一个文件 /etc/shadow 中）
用户账户的UID(数字形式)
用户账户的组ID(GID)(数字形式)
用户账户的文本描述(称为备注字段)
用户HOME目录的位置
用户的默认shell

##### 1.3.2 /etc/shadow
/etc/shadow文件对Linux系统密码管理提供了更多的控制。只有root用户才能访问/etc/shadow 文件
> /etc/shadow 包含如下记录：
与/etc/passwd文件中的登录名字段对应的登录名
加密后的密码
自上次修改密码后过去的天数密码(自1970年1月1日开始计算)
多少天后才能更改密码
多少天后必须更改密码
密码过期前提前多少天提醒用户更改密码
密码过期后多少天禁用用户账户
用户账户被禁用的日期(用自1970年1月1日到当天的天数表示)
预留字段给将来使用

##### 1.3.3 用户管理
创建用户：useradd
删除用户：userdel
修改用户：
usermod，功能最强大，能修改/etc/passwd 大部分字段。
>-c 修改备注字段,
-e 修改过期日期
-g 修改默认的登录组)
-l 修改用户账户的登录名
-L 锁定账户,使用户无法登录
-p 修改账户的密码
-U 解除锁定,使用户能够登录

passwd和chpasswd(批量),修改密码
chsh(修改默认shell)、chfn(在/etc/passwd文件备注字段存储信息)、change(管理用户账户有效期)

##### 1.3.4 组管理
创建组：groupadd
组添加用户：usermod
修改组：groupmod

##### 1.3.5 文件权限
```
# ls -l 展示范例
-rwxrwxr-x 2 rich rich 4096 2010-09-03 15:12 test2
```
第一个字段是描述文件和目录权限的编码，之后有3组3字符的编码，分别定义了对象的3个安全级别：对象的拥有者，对象的组，系统的其他用户

文件类型符：

| 操作符 | 含义 |
| :------------- | :------------- |
| - | 代表文件 |
| d | 代表目录 |
| l | 代表链接 |
| c | 代表字符型设备 |
| b | 代表块设备 |
| n | 代表网络设备 |

文件访问权限符：
| r | 代表对象是可读的 |
| w | 代表对象是可写的 |
| x | 代表对象是可执行的 |
如果没有某种权限，在该权限位以 - 代替

上面范例说明登录名为rich的用户可以读取、写入以及执行这个文件(可以看作有全部权限)。类似地,rich组的成员也可以读取、写入和执行这个文件。然而不属于rich组的其他用户只能读取和执行这个文件: w 被单破折线取代了,说明这个安全级别没有写入权限。

权限符与权限码之间的转换，文件权限码为8进制,三组3字符转换为3位8进制数

| 权限 | 二进制值 | 八进制值 | 描述 |
| :------------- | :------------- | :------------- | :------------- |
| --- | 000 | 0 | 没有任何权限 |
| --x | 001 | 1 | 只有执行权限 |
| -w- | 010 | 2 | 只有写入权限 |
| -wx | 011 | 3 | 有写入和执行权限 |
| r-- | 100 | 4 | 只有读取权限 |
| r-x | 101 | 5 | 有读取和执行权限 |
| rw- | 110 | 6 | 有读取和写入权限 |
| rwx | 111 | 7 | 有全部权限 |

##### 1.3.6 改变安全性设置
改变权限：chmod
改变文件的属主：chown
改变文件的默认属组：chgrp

### 2.shell
#### 2.1 shell基础
shell命令分为内部命令和外部命令。
+ 外部命令
外部命令,有时候也被称为文件系统命令,是存在于bash shell之外的程序。它们并不是shell程序的一部分。外部命令程序通常位于/bin、/usr/bin、/sbin或/usr/sbin中。
```
# ps 就是个外部命令，可以使用which和type找到它
which ps #---> /bin/ps
type -a ps #---> ps is /bin/ps
```
当外部命令执行时，会创建一个子进程。

+ 内部命令
内建命令和外部命令的区别在于前者不需要使用子进程来执行。它们已经和shell编译成了一体,作为shell工具的组成部分存在。
```
type cd #--->cd is a shell builtin
```

在涉及环境变量名时,什么时候该使用 $ ,什么时候不该使用 $ ,实在让人摸不着头脑。
记住一点就行了:如果要用到变量,使用 $ ;如果要操作变量,不使用 $ 。
